<!--
abbrlink: fes9wogn
title: æ­å»ºå®¶åº­æœåŠ¡å™¨&å†…ç½‘ç©¿é€
-->

- [å†…ç½‘ç©¿é€ä¹‹æ—…](#å†…ç½‘ç©¿é€ä¹‹æ—…)
- [æœåŠ¡ç«¯(äº‘ä¸»æœº) nginx é…ç½®](#æœåŠ¡ç«¯äº‘ä¸»æœº-nginx-é…ç½®)
	- [æœåŠ¡ç«¯(äº‘ä¸»æœº) nginx æ·»åŠ  http æœåŠ¡](#æœåŠ¡ç«¯äº‘ä¸»æœº-nginx-æ·»åŠ -http-æœåŠ¡)
- [frp](#frp)
	- [æœåŠ¡ç«¯(äº‘ä¸»æœº)é…ç½®](#æœåŠ¡ç«¯äº‘ä¸»æœºé…ç½®)
	- [è¿›ä¸€æ­¥åœ°ä½¿ç”¨ pm2 è¿è¡Œ frps](#è¿›ä¸€æ­¥åœ°ä½¿ç”¨-pm2-è¿è¡Œ-frps)
	- [å®¢æˆ·ç«¯(æ ‘è“æ´¾)é…ç½®](#å®¢æˆ·ç«¯æ ‘è“æ´¾é…ç½®)
- [å®‰è£… Node.js](#å®‰è£…-nodejs)
- [æ·»åŠ  SSH æœåŠ¡](#æ·»åŠ -ssh-æœåŠ¡)

### å†…ç½‘ç©¿é€ä¹‹æ—…

> ğŸ¤” é—®é¢˜: frp çš„æ ¸å¿ƒåŸç†æ˜¯ä»€ä¹ˆ?

è¦å®ç°å¤–ç½‘å¯ä»¥è®¿é—®çš„å®¶åº­æœåŠ¡å™¨ï¼Œç¬”è€…ä½¿ç”¨äº† [frp](https://github.com/fatedier/frp) åå‘ä»£ç†æŠ€æœ¯ã€‚

> todo: read https://github.com/fatedier/frp/blob/dev/README_zh.md

### æœåŠ¡ç«¯(äº‘ä¸»æœº) nginx é…ç½®

é¦–å…ˆå°†åŸŸå(ç¬”è€…ä¸º frp.muyunyun.cn )è§£æåˆ°æœåŠ¡å™¨ ipã€‚

ä¸ºäº†æ–¹é¢åç»­çš„è°ƒè¯•è¿è¡Œï¼Œéœ€æ”¾å¼€ä»¥ä¸‹å‡ ä¸ªæœåŠ¡å™¨ç«¯å£ã€‚

* 90 ç«¯å£:ï¼ˆNginx æ¥æ”¶ http è¯·æ±‚ç”¨ï¼‰
* 6000 ç«¯å£:ï¼ˆè½¬å‘æ˜ å°„ SSH æœåŠ¡ç”¨ï¼‰
* 8080 ç«¯å£:ï¼ˆè½¬å‘æ˜ å°„ http æœåŠ¡ç”¨ï¼‰
* 7000 ç«¯å£:ï¼ˆæœåŠ¡å™¨ç«¯ frps è¿è¡Œç«¯å£ï¼‰

é…ç½® Nginxï¼Œè½¬å‘å¯¹ frp.muyunyun.cn åŸŸåè¯·æ±‚åˆ° 8080 ç«¯å£ã€‚

`/etc/nginx/nginx.conf` è®¾ç½®å¦‚ä¸‹:

```bash
user www-data;
worker_processes auto;
pid /run/nginx.pid;
include /etc/nginx/modules-enabled/*.conf;
load_module /usr/lib/nginx/modules/ngx_stream_module.so;

stream {
	map $ssl_preread_server_name $backend_name {
		frp.muyunyun.cn        frp_muyunyun_cn;
		default web;
	}

	upstream frp_muyunyun_cn {
		server 127.0.0.1:8080;
	}

	upstream web {
		server 127.0.0.1:80;
	}
}

events {
	worker_connections 768;
	# multi_accept on;
}

http {
	##
	# Basic Settings
	##

	sendfile on;
	tcp_nopush on;
	tcp_nodelay on;
	keepalive_timeout 65;
	types_hash_max_size 2048;
	# server_tokens off;

	# server_names_hash_bucket_size 64;
	# server_name_in_redirect off;

	include /etc/nginx/mime.types;
	default_type application/octet-stream;

	##
	# SSL Settings
	##

	ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3; # Dropping SSLv3, ref: POODLE
	ssl_prefer_server_ciphers on;

	##
	# Logging Settings
	##

	access_log /var/log/nginx/access.log;
	error_log /var/log/nginx/error.log;

	##
	# Gzip Settings
	##

	gzip on;

	# gzip_vary on;
	# gzip_proxied any;
	# gzip_comp_level 6;
	# gzip_buffers 16 8k;
	# gzip_http_version 1.1;
	# gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;

	##
	# Virtual Host Configs
	##

	include /etc/nginx/conf.d/*.conf;
	include /etc/nginx/sites-enabled/*;
}
```

#### æœåŠ¡ç«¯(äº‘ä¸»æœº) nginx æ·»åŠ  http æœåŠ¡

> ğŸ¤” é—®é¢˜: `/etc/nginx/conf.d/frp.muyunyun.cn.conf` æ–‡ä»¶ä¸­çš„é…ç½®ä¸ `/etc/nginx/nginx.conf` ä¸­çš„é…ç½®ä½œç”¨çš„å¯¹è±¡åˆ†åˆ«æ˜¯ä»€ä¹ˆ?

ä»¥é…ç½®åŸŸå frp.muyunyun.cn ä¸ºä¾‹ï¼Œæ–°å»ºé…ç½®æ–‡ä»¶ `/etc/nginx/conf.d/frp.muyunyun.cn.conf`

```bash
touch /etc/nginx/conf.d/frp.muyunyun.cn.conf
```

åœ¨ `/etc/nginx/conf.d/frp.muyunyun.cn.conf` ä¸­æ·»åŠ  http æœåŠ¡ç›¸å…³å†…å®¹

```
server {
	server_name      frp.muyunyun.cn;
	listen           90;
	root             /usr/share/nginx/html/frp.muyunyun.cn;

	location / {
		proxy_pass http://127.0.0.1:8080;
		proxy_set_header Host $host:90;
		proxy_set_header X-Real-IP $remote_addr;
		proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
	}

	error_page 404 /404.html;
		location = /40x.html {
	}

	error_page 500 502 503 504 /50x.html;
		location = /50x.html {
	}
}
```

> ç«¯å£ä½¿ç”¨ 80 é¡µé¢ä¼šæç¤º`ç½‘ç«™æš‚æ—¶æ— æ³•è®¿é—®ï¼Œè¯¥ç½‘ç«™æœªæ ¹æ®å·¥ä¿¡éƒ¨ç›¸å…³æ³•å¾‹è§„åˆ™è¿›è¡Œå¤‡æ¡ˆ`ï¼Œ[äº†è§£æ›´å¤šå¤‡æ¡ˆç›¸å…³å†…å®¹](https://icp-faq.dnspod.cn/why)ï¼Œç¬”è€…è¿™é‡Œå°†å®ƒä¿®æ”¹ä¸º 90ã€‚

![](http://with.muyunyun.cn/04afbf893d08548ebd06a85488389298.jpg-400)

æ–°å»º `frp.muyunyun.cn` å¯¹åº”çš„ç½‘ç«™æ–‡ä»¶å¤¹ä¸æ–‡ä»¶

```bash
mkdir -p /usr/share/nginx/html/frp.muyunyun.cn
touch /usr/share/nginx/html/frp.muyunyun.cn/index.html
```

åœ¨ `/usr/share/nginx/html/fpr.muyunyun.cn/index.html` ä¸­è¾“å…¥

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>äº‘éšé£</title>
</head>
<body>Test</body>
</html>
```

æ§åˆ¶å°è¾“å…¥ `sudo systemctl restart nginx`ã€‚

æ­¤æ—¶åœ¨æµè§ˆå™¨è®¿é—® http://frp.muyunyun.cn:90 å¯ä»¥çœ‹åˆ°ç›®æ ‡å†…å®¹:

![](http://with.muyunyun.cn/4373b2aaca032ed2a78fac53279532d2.jpg)

### frp

#### æœåŠ¡ç«¯(äº‘ä¸»æœº)é…ç½®

åœ¨äº‘ä¸»æœºç«¯æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤:

```bash
cd /opt/
sudo wget https://github.com/fatedier/frp/releases/download/v0.37.0/frp_0.37.0_linux_386.tar.gz
sudo tar zxvf frp_0.37.0_linux_386.tar.gz
```

è¿›å…¥ `/opt/frp_0.37.0_linux_arm64`

![](http://with.muyunyun.cn/32f4ce6995482f6e086b85d2bdd06a01.jpg)

å¤‡ä»½å®¢æˆ·ç«¯ frpc çš„é…ç½®æ–‡ä»¶ frpc.ini

```bash
sudo cp frps.ini frps.ini_backup
```

ä¿®æ”¹æœåŠ¡ç«¯é…ç½®æ–‡ä»¶ frps.iniï¼Œå¢åŠ ä¸€è¡Œ `vhost_http_port = 8080`:

```diff
[common]
bind_port = 7000
+ vhost_http_port = 8080
```

ä»¥ä¸Šé…ç½®å«ä¹‰ä¸º: æœåŠ¡ç«¯ frps ç¨‹åºè¿è¡Œåœ¨ 7000 ç«¯å£ï¼Œå¹¶å°†æŒ‡å‘ 8080 ç«¯å£çš„è¯·æ±‚è½¬å‘åˆ°å®¢æˆ·ç«¯ã€‚

è¿è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œå¼€å¯ frp çš„æœåŠ¡ç«¯ç¨‹åº

```bash
./frps -c frps.ini
```

![](http://with.muyunyun.cn/eb0a4e394f5b656b3e67c13c6ab1eb82.jpg)

#### è¿›ä¸€æ­¥åœ°ä½¿ç”¨ pm2 è¿è¡Œ frps

å®‰è£… node ç¯å¢ƒ

> [å®‰è£… Node.js å¤šç‰ˆæœ¬](https://cloud.tencent.com/document/product/213/38237#.E6.AD.A5.E9.AA.A43.EF.BC.9A.E5.AE.89.E8.A3.85-node.js-.E5.A4.9A.E7.89.88.E6.9C.AC.EF.BC.88.E5.8F.AF.E9.80.89.EF.BC.89)

å…¨å±€å®‰è£… pm2

```bash
npm i pm2 -g
```

ä½¿ç”¨ pm2 å®ˆæŠ¤è¿è¡Œ frps æœåŠ¡

```bash
sudo echo "/opt/frp_0.37.0_linux_386/frps -c /opt/frp_0.37.0_linux_386/frps.ini" > /opt/frp_0.37.0_linux_386/start_frpc.sh
pm2 start /opt/frp_0.37.0_linux_386/start_frps.sh
pm2 save
```

![](http://with.muyunyun.cn/e52ef19b14366896e5de3c6bf7bce609.jpg)

#### å®¢æˆ·ç«¯(æ ‘è“æ´¾)é…ç½®

åœ¨æ ‘è“æ´¾å†…æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œä¸‹è½½ frpï¼Œå¹¶è§£å‹ã€‚

```bash
cd /opt/
sudo wget https://github.com/fatedier/frp/releases/download/v0.37.0/frp_0.37.0_linux_arm64.tar.gz
sudo tar zxvf frp_0.37.0_linux_arm64.tar.gz
```

è¿›å…¥ `/opt/frp_0.37.0_linux_arm64`

å¤‡ä»½å®¢æˆ·ç«¯ frpc çš„é…ç½®æ–‡ä»¶ frpc.ini

```bash
sudo cp frpc.ini frpc.ini_backup
```

ç¼–è¾‘ frpc.iniï¼Œå¤‡ä»½å¦‚ä¸‹:

```bash
[common]
server_addr = 127.0.0.1
server_port = 7000

[ssh]
type = tcp
local_ip = 127.0.0.1
local_port = 22
remiote_port = 6000
```

```bash
sudo vim frpc.ini
```

```bash
[common]
server_addr = 81.69.252.246
server_port = 7000

[web]
type = http
local_port = 8080
custom_domains = frp.muyunyun.cn
```

å¯åŠ¨å®¢æˆ·ç«¯

```bash
./frpc -c frpc.ini
```

æ¥ç€ä»å…¬ç½‘è®¿é—® frp.muyunyun.cn:90ï¼ŒéªŒè¯å†…ç½‘ç©¿é€æ˜¯å¦æˆåŠŸã€‚

![](http://with.muyunyun.cn/c61981adbdaba27efbc45b26c1921891.jpg-400)

å¯ä»¥çœ‹åˆ°æ¥è‡ªå…¬ç½‘çš„è¯·æ±‚åœ¨æ ‘è“æ´¾çš„ frp å®¢æˆ·ç«¯å·²ç»æœ‰äº†ååº”ï¼Œæ¥ç€æˆ‘ä»¬åœ¨æ ‘è“æ´¾æ­å»ºä¸€ä¸ªç®€å•æœåŠ¡ã€‚

### å®‰è£… Node.js

ä½¿ç”¨ ARMv8 ç‰ˆæœ¬çš„ç¨³å®šç‰ˆ Node.jsã€‚

```bash
cd /opt/
sudo wget https://nodejs.org/dist/v14.18.0/node-v14.18.0-linux-arm64.tar.xz
sudo tar xvf node-v14.18.0-linux-arm64.tar.xz
```

å°† Node.js æ·»åŠ åˆ°ç³»ç»Ÿå˜é‡

```bash
sudo echo "export NODE_HOME=/opt/node-v14.18.0-linux-arm64" >> ~/.bashrc
sudo echo "export PATH=\$NODE_HOME/bin:\$PATH" >> ~/.bashrc
source ~/.bashrc
```

æ­¤æ—¶åœ¨æ ‘è“æ´¾ä¸­è¾“å…¥ node -vï¼Œå¯ä»¥çœ‹åˆ°å¯¹åº”ç‰ˆæœ¬å¦‚ä¸‹:

```bash
ubuntu@ubuntu:~$ node -v
v14.18.0
ubuntu@ubuntu:~$ npm -v
6.14.15
```

æ¥ç€å®‰è£… http-server æœåŠ¡

```bash
npm install http-server -g
```

åœ¨ /opt æ–‡ä»¶å¤¹ æ–°å»º frp.muyunyun.cn æ–‡ä»¶å¤¹, å¹¶åˆ›å»º hello.txt æ–‡ä»¶ã€‚

```bash
sudo mkdir /opt/frp.muyunyun.cn
sudo chmod 777 -R /opt/frp.muyunyun.cn
sudo touch /opt/frp.muyunyun.cn/hello.txt
sudo chmod 777 -R /opt/frp.muyunyun.cn/hello.txt
sudo echo "Hello World!" > /opt/frp.muyunyun.cn/hello.txt
```

å®‰è£… pm2

```bash
npm install pm2 -g
```

ä½¿ç”¨ pm2 å®ˆæŠ¤è¿è¡Œ http-server æœåŠ¡

```bash
cd /opt/frp_0.37.0_linux_arm64
sudo touch start_http_server.sh
sudo chmod 777 start_http_server.sh
sudo echo "http-server /opt/frp.muyunyun.cn -p 8080" > start_http_server.sh
pm2 start /opt/frp_0.37.0_linux_arm64/start_http_server.sh
pm2 save
```

ä½¿ç”¨ pm2 å®ˆæŠ¤è¿è¡Œ frpc æœåŠ¡

```bash
sudo touch /opt/frp_0.37.0_linux_arm64/start_frpc.sh
sudo chmod 777 /opt/frp_0.37.0_linux_arm64/start_frpc.sh
sudo echo "/opt/frp_0.37.0_linux_arm64/frpc -c /opt/frp_0.37.0_linux_arm64/frpc.ini" > /opt/frp_0.37.0_linux_arm64/start_frpc.sh
cd /opt/frp_0.37.0_linux_arm64/
pm2 start /opt/frp_0.37.0_linux_arm64/start_frpc.sh
pm2 save
```

å¯ä»¥ä½¿ç”¨ `pm2 list` æŸ¥çœ‹å½“å‰æ ‘è“æ´¾ä¸­çš„æœåŠ¡åˆ—è¡¨ã€‚

![](http://with.muyunyun.cn/442c4a0b41ad3bc6fcbb09f6d162bd06.jpg)

åœ¨å…¬ç½‘è®¿é—® frp.muyunyun.cn:90ã€‚ğŸ’ğŸ’ğŸ’è‡³æ­¤æœ‰äº†å¤–ç½‘å¯ä»¥è®¿é—®çš„å®¶åº­æœåŠ¡å™¨ã€‚

![](http://with.muyunyun.cn/fac7d7c9a8098d72f98cd6f4485347cd.jpg)

### æ·»åŠ  SSH æœåŠ¡

```bash
[ssh]
type = tcp
local_ip = 127.0.0.1
local_port = 22
remote_port = 6000
```

å¦‚ä¸Šé…ç½®æ˜¯æŒ‡å°†æ ‘è“æ´¾çš„é»˜è®¤ ssh çš„ 22 å·ç«¯å£æ˜ å°„åˆ° frp.muyunyun.cn çš„ 6000 ç«¯å£ã€‚

é‡å¯ frpc æœåŠ¡:

```bash
cd /opt/frp_0.37.0_linux_arm64
pm2 restart start_frpc.sh
```

é€šè¿‡å…¬ç½‘ frp.muyunyun.cn çš„ 6000 ç«¯å£è¿›è¡Œ ssh ç™»å½•ã€‚

```bash
ssh ubuntu@frp.muyunyun.cn -p 6000
```

![](http://with.muyunyun.cn/43431e73e8a218fb9e0a494f61f8f0df.jpg)
