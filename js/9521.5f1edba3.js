(self.webpackChunkblog=self.webpackChunkblog||[]).push([[9521],{79521:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>i});var a=n(59713),o=n.n(a),l=n(6479),r=n.n(l),s=(n(67294),n(3905));function u(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?u(Object(n),!0).forEach((function(t){o()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var c={};function i(e){var t=e.components,n=r()(e,["components"]);return(0,s.kt)("wrapper",p(p(p({},c),n),{},{components:t,mdxType:"MDXLayout"}),(0,s.kt)("h3",null,"React Logo ä¸ Hooks"),(0,s.kt)("p",null,(0,s.kt)("img",p({parentName:"p"},{src:"http://with.muyunyun.cn/ddbdcec2fc39ba350fc74647f4fad6f5.jpg-300",alt:null}))),(0,s.kt)("p",null,"React çš„ logo æ˜¯ä¸€ä¸ªåŸå­å›¾æ¡ˆ, åŸå­ç»„æˆäº†ç‰©è´¨çš„è¡¨ç°ã€‚ç±»ä¼¼çš„, React å°±åƒåŸå­èˆ¬æ„æˆäº†é¡µé¢çš„è¡¨ç°; è€Œ Hooks å°±å¦‚å¤¸å…‹, å…¶æ›´æ¥è¿‘ React æœ¬è´¨çš„æ ·å­, ä½†æ˜¯ç›´åˆ° 4 å¹´åçš„ä»Šå¤©æ‰è¢«çœŸæ­£è®¾è®¡å‡ºæ¥ã€‚ â€”â€” Dan in React Conf(2018)"),(0,s.kt)("h3",null,"WHY HOOKS?"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},"å¤šä¸ªç»„ä»¶é—´é€»è¾‘å¤ç”¨"),": åœ¨ Class ä¸­ä½¿ç”¨ React ä¸èƒ½å°†å¸¦æœ‰ state çš„é€»è¾‘ç»™å•ç‹¬æŠ½ç¦»æˆ function, å…¶åªèƒ½é€šè¿‡åµŒå¥—ç»„ä»¶çš„æ–¹å¼æ¥è§£å†³å¤šä¸ªç»„ä»¶é—´é€»è¾‘å¤ç”¨çš„é—®é¢˜, åŸºäºåµŒå¥—ç»„ä»¶çš„æ€æƒ³å­˜åœ¨ ",(0,s.kt)("a",p({parentName:"li"},{href:"https://github.com/MuYunyun/blog/blob/master/React/%E4%BB%8E0%E5%88%B01%E5%AE%9E%E7%8E%B0React/8.HOC%E6%8E%A2%E7%B4%A2.md"}),"HOC")," ä¸ ",(0,s.kt)("inlineCode",{parentName:"li"},"render props")," ä¸¤ç§è®¾è®¡æ¨¡å¼ã€‚ä½†æ˜¯è¿™ä¸¤ç§è®¾è®¡æ¨¡å¼æ˜¯å¦å­˜åœ¨ç¼ºé™·å‘¢?",(0,s.kt)("ul",{parentName:"li"},(0,s.kt)("li",{parentName:"ul"},"åµŒå¥—åœ°ç‹±, å½“åµŒå¥—å±‚çº§è¿‡å¤šå, æ•°æ®æºçš„è¿½æº¯ä¼šå˜å¾—ååˆ†å›°éš¾, å¯¼è‡´å®šä½ bug ä¸å®¹æ˜“; (hocã€render props)"),(0,s.kt)("li",{parentName:"ul"},"æ€§èƒ½, é¢å¤–çš„ç»„ä»¶å®ä¾‹éœ€è¦å­˜åœ¨é¢å¤–çš„å¼€é”€; (Hocã€Render props)"),(0,s.kt)("li",{parentName:"ul"},"å‘½åé‡å¤æ€§, åœ¨ä¸€ä¸ªç»„ä»¶ä¸­åŒæ—¶ä½¿ç”¨å¤šä¸ª hoc, ä¸æ’é™¤è¿™äº› hoc é‡Œçš„æ–¹æ³•å­˜åœ¨å‘½åå†²çªçš„é—®é¢˜; (hoc)"))),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},"å•ä¸ªç»„ä»¶ä¸­çš„é€»è¾‘å¤ç”¨"),": Class ä¸­çš„ç”Ÿå‘½å‘¨æœŸ ",(0,s.kt)("inlineCode",{parentName:"li"},"componentDidMount"),"ã€",(0,s.kt)("inlineCode",{parentName:"li"},"componentDidUpdate")," ç”šè‡³ ",(0,s.kt)("inlineCode",{parentName:"li"},"componentWillUnMount")," ä¸­çš„å¤§å¤šæ•°é€»è¾‘åŸºæœ¬æ˜¯ç±»ä¼¼çš„, å¿…é¡»æ‹†æ•£åœ¨ä¸åŒç”Ÿå‘½å‘¨æœŸä¸­ç»´æŠ¤ç›¸åŒçš„é€»è¾‘å¯¹ä½¿ç”¨è€…æ˜¯ä¸å‹å¥½çš„, è¿™æ ·ä¹Ÿé€ æˆäº†å†—ä½™çš„ç»„ä»¶ä»£ç é‡ã€‚"),(0,s.kt)("li",{parentName:"ul"},"Class çš„å…¶å®ƒä¸€äº›é—®é¢˜: ä¹¦å†™ Class ç»„ä»¶æ—¶éœ€è¦å¤§é‡æ ·æ¿ä»£ç , ç”¨æˆ·é€šå¸¸ä¼šå¯¹ Class ä¸­ Constructor çš„ bind ä»¥åŠ this çš„ä½¿ç”¨æ„Ÿåˆ°å›°æƒ‘(Todo: ä¸¾ä¾‹); å½“ Class ä¸ TypeScript ç»“åˆä¸€èµ·ä½¿ç”¨æ—¶, éœ€è¦å¯¹ defaultValue åšé¢å¤–å£°æ˜å¤„ç†; æ­¤å¤– React Team è¡¨ç¤º Class åœ¨æœºå™¨ç¼–è¯‘ä¼˜åŒ–æ–¹é¢ä¹Ÿä¸æ˜¯å¾ˆç†æƒ³ã€‚",(0,s.kt)("ul",{parentName:"li"},(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",p({parentName:"li"},{href:"https://github.com/vuejs/rfcs/pull/17#issuecomment-494242121"}),"Vue: Update: the Class API proposal is being dropped."))))),(0,s.kt)("p",null,"------- 2020.07.19 -------"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("p",{parentName:"li"},"ç»„ä»¶é‡æ„")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("p",{parentName:"li"},"React Hooks çš„å¸¸è§é™·é˜±"),(0,s.kt)("ul",{parentName:"li"},(0,s.kt)("li",{parentName:"ul"},"é—­åŒ…é™·é˜±, (useInterval, useFetch)"),(0,s.kt)("li",{parentName:"ul"},"Hooks è§„åˆ™é™·é˜±(è§èŠ±åª›æœ€æ–°èŠå¤©è®°å½•), eslint-hooks æ’ä»¶"))),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("p",{parentName:"li"},"Hooks ä¸èƒ½åšåˆ°?"),(0,s.kt)("ul",{parentName:"li"},(0,s.kt)("li",{parentName:"ul"},"Matrix ç»„ä»¶"))),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("p",{parentName:"li"},"[https://zhuanlan.zhihu.com/p/103150605]",", åˆ†äº«ä¸€ç¯‡æµç•…é£è¶£çš„ hooks æ–‡ç« , æ–‡é£é£è¶£ä¸é”™, å¯ä»¥å€Ÿé‰´ã€‚"))),(0,s.kt)("p",null,"---------- more ---------"),(0,s.kt)("h3",null,"useState è¿”å›çš„å€¼ä¸ºä»€ä¹ˆæ˜¯æ•°ç»„è€Œéå¯¹è±¡?"),(0,s.kt)("p",null,"åŸå› æ˜¯æ•°ç»„çš„è§£æ„æ¯”å¯¹è±¡æ›´åŠ æ–¹ä¾¿, å¯ä»¥è§‚å¯Ÿä»¥ä¸‹ä¸¤ç§æ•°æ®ç»“æ„è§£æ„çš„å·®å¼‚ã€‚"),(0,s.kt)("p",null,"è¿”å›æ•°ç»„æ—¶, å¯ä»¥ç›´æ¥è§£æ„æˆä»»æ„åå­—ã€‚"),(0,s.kt)("pre",null,(0,s.kt)("code",p({parentName:"pre"},{className:"language-js"}),"[name, setName] = useState('è·¯é£')\n[age, setAge] = useState(12)\n")),(0,s.kt)("p",null,"è¿”å›å¯¹è±¡æ—¶, å´éœ€è¦å¤šä¸€å±‚çš„å‘½åã€‚"),(0,s.kt)("pre",null,(0,s.kt)("code",p({parentName:"pre"},{className:"language-js"}),"{value: name, setValue: setName} = useState('è·¯é£')\n{value: name, setValue: setName} = useState(12)\n")),(0,s.kt)("h3",null,"Hooks ä¼ é€’çš„è®¾è®¡"),(0,s.kt)("p",null,"Hooks æ˜¯å¦å¯ä»¥è®¾è®¡æˆåœ¨ç»„ä»¶ä¸­é€šè¿‡å‡½æ•°ä¼ å‚æ¥ä½¿ç”¨? æ¯”å¦‚è¿›è¡Œå¦‚ä¸‹è°ƒç”¨?"),(0,s.kt)("pre",null,(0,s.kt)("code",p({parentName:"pre"},{className:"language-js"}),"const SomeContext = require('./SomeContext)\n\nfunction Example({ someProp }, hooks) {\n  const contextValue = hooks.useContext(SomeContext)\n  return <div>{someProp}{contextValue}</div>\n}\n")),(0,s.kt)("p",null,"ä½¿ç”¨ä¼ é€’çš„åŠ£åŠ¿æ˜¯ä¼šå‡ºç°å†—ä½™çš„ä¼ é€’ã€‚(å¯ä»¥è”æƒ³ Context è§£å†³äº†ä»€ä¹ˆ)"),(0,s.kt)("h3",null,"Hooks ä¸ Class ä¸­è°ƒç”¨ setState æœ‰ä¸åŒçš„è¡¨ç°å·®å¼‚ä¹ˆ?"),(0,s.kt)("p",null,"Hooks ä¸­çš„ setState ä¸ Class ä¸­æœ€å¤§åŒºåˆ«åœ¨äº Hooks ä¸ä¼šå¯¹å¤šæ¬¡ setState è¿›è¡Œåˆå¹¶æ“ä½œã€‚å¦‚æœè¦æ‰§è¡Œåˆå¹¶æ“ä½œ, å¯æ‰§è¡Œå¦‚ä¸‹æ“ä½œ:"),(0,s.kt)("pre",null,(0,s.kt)("code",p({parentName:"pre"},{className:"language-js"}),"setState(prevState => {\n  return { ...prevState, ...updateValues }\n})\n")),(0,s.kt)("p",null,"æ­¤å¤–å¯ä»¥å¯¹ class ä¸ Hooks ä¹‹é—´ ",(0,s.kt)("inlineCode",{parentName:"p"},"setState")," æ˜¯å¼‚æ­¥è¿˜æ˜¯åŒæ­¥çš„è¡¨ç°è¿›è¡Œå¯¹æ¯”, å¯ä»¥å…ˆå¯¹ä»¥ä¸‹ 4 ç§æƒ…å½¢ render è¾“å‡ºçš„ä¸ªæ•°è¿›è¡Œè§‚å¯Ÿåˆ†æ:"),(0,s.kt)("p",null,"class ä¸­çš„ setState:"),(0,s.kt)("pre",null,(0,s.kt)("code",p({parentName:"pre"},{className:"language-js"}),"export default class App extends React.Component {\n  state = {\n    name: 'è·¯é£',\n    old: 12,\n    gender: 'boy'\n  }\n\n  // æƒ…å½¢ â‘ : class ä¸­å¼‚æ­¥è°ƒç”¨ setState\n  componentDidMount() {\n    this.setState({\n      name: 'å¨œç¾'\n    })\n    this.setState({\n      old: 13\n    })\n    this.setState({\n      gender: 'girl'\n    })\n  }\n\n  // æƒ…å½¢ â‘¡: class ä¸­åŒæ­¥è°ƒç”¨ setState\n  componentDidMount() {\n    setTimeout(() => {\n      this.setState({\n        name: 'å¨œç¾'\n      })\n      this.setState({\n        old: 13\n      })\n      this.setState({\n        gender: 'girl'\n      })\n    })\n  }\n\n  render() {\n    console.log('render')\n    const { name, old, gender } = this.state\n    return (\n      <>{name}{old}{gender}</>\n    )\n  }\n}\n")),(0,s.kt)("p",null,"Hooks ä¸­çš„ setState"),(0,s.kt)("pre",null,(0,s.kt)("code",p({parentName:"pre"},{className:"language-js"}),"export default function() {\n  const [name, setName] = useState('è·¯é£')\n  const [old, setOld] = useState('12')\n  const [gender, setGender] = useState('boy')\n\n  // æƒ…å½¢â‘¢: Hooks ä¸­å¼‚æ­¥è°ƒç”¨ setState\n  useEffect(() => {\n    setName('å¨œç¾')\n    setOld('13')\n    setGender('girl')\n  }, [])\n\n  // æƒ…å½¢â‘£: Hooks ä¸­åŒæ­¥è°ƒç”¨ setState\n  useEffect(() => {\n    setTimeout(() => {\n      setName('å¨œç¾')\n      setOld('13')\n      setGender('girl')\n    }, 0)\n  }, [])\n\n  console.log('render')\n  return (\n    <>{name}{old}{gender}</>\n  )\n}\n")),(0,s.kt)("p",null,"æƒ…å½¢â‘ ã€æƒ…å½¢â‘¡ã€æƒ…å½¢â‘¢ã€æƒ…å½¢â‘£ ä¸­ render è¾“å‡ºçš„æ¬¡æ•°åˆ†åˆ«æ˜¯ 2, 4, 2, 4ã€‚å¯ä»¥çœ‹å‡ºåœ¨ React ä¸­ä½¿ç”¨ class å†™æ³•å’Œ hooks å†™æ³•æ˜¯ä¸€ä¸€å¯¹åº”çš„ã€‚æ­¤å¤– ",(0,s.kt)("inlineCode",{parentName:"p"},"setState çš„æ‰§è¡Œæ˜¯å¼‚æ­¥è¿˜æ˜¯åŒæ­¥å–å†³äºå…¶æ‰§è¡Œç¯å¢ƒ"),"ã€‚"),(0,s.kt)("h3",null,"å¦‚ä½•åœ¨ Hooks ä¸­æ¨¡æ‹Ÿ setState çš„ç¬¬äºŒä¸ªå‚æ•°"),(0,s.kt)("p",null,"åœºæ™¯: åœ¨ä½¿ç”¨ç±»æ¨¡å¼çš„ React ä¸­æœ‰æ—¶ä¼šä½¿ç”¨ setState çš„ç¬¬äºŒä¸ªå‚æ•°æ¥å®ŒæˆæŸäº›å¼‚æ­¥å›è°ƒæ“ä½œ(æ¯”å¦‚æ¥å£è¯·æ±‚), åœ¨ Hooks ä¸­å¦‚ä½•å¯¹é½ç±»æ¨¡å¼ä¸­çš„è¿™ç§ç”¨æ³•å‘¢?"),(0,s.kt)("p",null,"ä½¿ç”¨ useRef æ¥æ§åˆ¶ä¸€ä¸ªæ ‡å¿—ç¬¦;"),(0,s.kt)("blockquote",null,(0,s.kt)("p",{parentName:"blockquote"},"å…·ä½“è§ ",(0,s.kt)("a",p({parentName:"p"},{href:"https://github.com/facebook/react/issues/14174#issuecomment-437551476"}),"issue"))),(0,s.kt)("h3",null,"Hooks ä¸­ useEffect çš„æ‰§è¡Œæ—¶é—´æ˜¯å¦ä¸ componentDidMount/componentDidUpdate ç›¸åŒ"),(0,s.kt)("p",null,"åœ¨ ",(0,s.kt)("a",p({parentName:"p"},{href:"https://reactjs.org/docs/hooks-reference.html#timing-of-effects"}),"timing-of-effects")," ä¸­æœ‰æåˆ° ",(0,s.kt)("inlineCode",{parentName:"p"},"useEffect")," çš„æ‰§è¡Œæ—¶æœºæ˜¯åœ¨æµè§ˆå™¨ä¸‹ä¸€æ¬¡ layout ä¸ paint ä¹‹å, ä¸ä¹‹ç›¸å¯¹çš„ ",(0,s.kt)("inlineCode",{parentName:"p"},"useLayoutEffect")," çš„æ‰§è¡Œæ—¶æœºæ˜¯åœ¨æµè§ˆå™¨ä¸‹ä¸€æ¬¡ layout ä¸ paint ä¹‹å‰(åŒ ",(0,s.kt)("inlineCode",{parentName:"p"},"componentDidMount"),"/",(0,s.kt)("inlineCode",{parentName:"p"},"componentDidUpdate"),")ã€‚"),(0,s.kt)("blockquote",null,(0,s.kt)("p",{parentName:"blockquote"},"useLayoutEffect é€‚ç”¨çš„åœºæ™¯ä¸ºåœ¨ class æ¨¡å¼ä¸‹åœ¨ componentDidMount/componentDidUpdate ä¸­å¯¹æ ·å¼è¿›è¡Œè°ƒæ•´çš„åœºæ™¯;")),(0,s.kt)("blockquote",null,(0,s.kt)("p",{parentName:"blockquote"},(0,s.kt)("a",p({parentName:"p"},{href:"https://medium.com/@dan_abramov/this-benchmark-is-indeed-flawed-c3d6b5b6f97f"}),"this-benchmark-is-indeed-flawed"),": æ­¤æ–‡ç”¨æ•°æ®æ¯”è¾ƒäº† useEffect ä¸ componentDidMount/componentDidUpdate çš„æ‰§è¡Œæ—¶æœºã€‚")),(0,s.kt)("h3",null,"Hooks ä¸­æ¨¡æ‹Ÿä»…è°ƒç”¨ componentDidUpdate è€Œä¸è°ƒç”¨ componentDidMount"),(0,s.kt)("p",null,"æ€è·¯: å€ŸåŠ© ",(0,s.kt)("inlineCode",{parentName:"p"},"useRef")," è·³è¿‡å¤´ä¸€æ¬¡çš„æ‰§è¡Œã€‚"),(0,s.kt)("pre",null,(0,s.kt)("code",p({parentName:"pre"},{className:"language-js"}),"function Demo() {\n  const mounted = React.useRef(false)\n\n  React.useEffect(() => {\n    if (!mounted.current) {\n      mounted.current = true\n    } else {\n      // do something mock componentDidUpdate\n    }\n  })\n}\n")),(0,s.kt)("h3",null,"Hooks ä¸­å¦‚ä½•è·å–å…ˆå‰çš„ props ä»¥åŠ state"),(0,s.kt)("p",null,"React å®˜æ–¹åœ¨æœªæ¥å¾ˆå¯èƒ½ä¼šæä¾›ä¸€ä¸ª ",(0,s.kt)("inlineCode",{parentName:"p"},"usePrevious")," çš„ hooks æ¥è·å–ä¹‹å‰çš„ props ä»¥åŠ stateã€‚"),(0,s.kt)("p",null,(0,s.kt)("inlineCode",{parentName:"p"},"usePrevious")," çš„æ ¸å¿ƒæ€æƒ³æ˜¯ç”¨ ref æ¥å­˜å‚¨å…ˆå‰çš„å€¼ã€‚"),(0,s.kt)("pre",null,(0,s.kt)("code",p({parentName:"pre"},{className:"language-js"}),"function usePrevous(value) {\n  const ref = useRef()\n  useEffect(() => {\n    ref.current = value\n  })\n  return ref.current\n}\n")),(0,s.kt)("h3",null,"Hooks ä¸­å¦‚ä½•è°ƒç”¨å®ä¾‹ä¸Šçš„æ–¹æ³•"),(0,s.kt)("p",null,"åœ¨ Hooks ä¸­ä½¿ç”¨ useRef() ç­‰ä»·äºåœ¨ Class ä¸­ä½¿ç”¨ this.somethingã€‚"),(0,s.kt)("pre",null,(0,s.kt)("code",p({parentName:"pre"},{className:"language-js"}),"/* in a function */\nconst X = useRef()\nX.current // can read or write\n\n/* in a Class */\nthis.X    // can read or write\n")),(0,s.kt)("blockquote",null,(0,s.kt)("p",{parentName:"blockquote"},(0,s.kt)("a",p({parentName:"p"},{href:"https://reactjs.org/docs/hooks-faq.html#is-there-something-like-instance-variables"}),"Is there something like instance variables"))),(0,s.kt)("h3",null,"Hooks ä¸­ getDerivedStateFromProps çš„æ›¿ä»£æ–¹æ¡ˆ"),(0,s.kt)("p",null,"åœ¨ ",(0,s.kt)("a",p({parentName:"p"},{href:"https://github.com/MuYunyun/blog/blob/master/React/React%E6%9A%97%E5%99%A8%E7%99%BE%E8%A7%A3.md"}),"React æš—å™¨ç™¾è§£")," ä¸­æåˆ°äº† ",(0,s.kt)("inlineCode",{parentName:"p"},"getDerivedStateFromProps")," æ˜¯ä¸€ç§åæ¨¡å¼, ä½†æ˜¯æå°‘æ•°æƒ…å†µè¿˜æ˜¯ç”¨å¾—åˆ°è¯¥é’©å­, Hooks æ²¡æœ‰è¯¥ api, é‚£å…¶å¦‚ä½•è¾¾åˆ° getDerivedStateFromProps çš„æ•ˆæœå‘¢?"),(0,s.kt)("pre",null,(0,s.kt)("code",p({parentName:"pre"},{className:"language-js"}),"function ScrollView({row}) {\n  const [isScrollingDown, setISScrollingDown] = setState(false)\n  const [prevRow, setPrevRow] = setState(null)\n\n  // æ ¸å¿ƒæ˜¯åˆ›å»ºä¸€ä¸ª prevRow state ä¸å‡½æ•°è°ƒç”¨æ–¹ä¼ è¿›æ¥çš„ row è¿›è¡Œæ¯”è¾ƒ\n  if (row !== prevRow) {\n    setISScrollingDown(prevRow !== null && row > prevRow)\n    setPrevRow(row)\n  }\n\n  return `Scrolling down ${isScrollingDown}`\n}\n")),(0,s.kt)("h3",null,"Hooks ä¸­ forceUpdate çš„æ›¿ä»£æ–¹æ¡ˆ"),(0,s.kt)("p",null,"å¯ä»¥ä½¿ç”¨ ",(0,s.kt)("inlineCode",{parentName:"p"},"useReducer")," æ¥ hack ",(0,s.kt)("inlineCode",{parentName:"p"},"forceUpdate"),", ä½†æ˜¯å°½é‡é¿å… forceUpdate çš„ä½¿ç”¨ã€‚"),(0,s.kt)("pre",null,(0,s.kt)("code",p({parentName:"pre"},{className:"language-js"}),"const useForceUpdate = () => {\n  return useReducer(x => x + 1, 0)[1]\n}\n\nfunction handleClick() {\n  const forceUpdate = useForceUpdate()\n  forceUpdate()\n}\n")),(0,s.kt)("h3",null,"Hooks ä¸­ shouldComponentUpdate çš„æ›¿ä»£æ–¹æ¡ˆ"),(0,s.kt)("p",null,"åœ¨ Hooks ä¸­å¯ä»¥ä½¿ç”¨ ",(0,s.kt)("inlineCode",{parentName:"p"},"useMemo")," æ¥ä½œä¸º ",(0,s.kt)("inlineCode",{parentName:"p"},"shouldComponentUpdate")," çš„æ›¿ä»£æ–¹æ¡ˆ, ä½† ",(0,s.kt)("inlineCode",{parentName:"p"},"useMemo")," åªå¯¹ props è¿›è¡Œæµ…æ¯”è¾ƒã€‚"),(0,s.kt)("pre",null,(0,s.kt)("code",p({parentName:"pre"},{className:"language-js"}),"React.useMemo((props) => {\n  // your component\n})\n")),(0,s.kt)("h4",null,"useMemo ä¸ useCallback çš„åŒºåˆ«"),(0,s.kt)("pre",null,(0,s.kt)("code",p({parentName:"pre"},{className:"language-js"}),"useMemo(() => <component />) ç­‰ä»·äº useCallback(<component />)\n")),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"useCallback",(0,s.kt)("ul",{parentName:"li"},(0,s.kt)("li",{parentName:"ul"},"ç¼“å­˜å‡½æ•°")))),(0,s.kt)("pre",null,(0,s.kt)("code",p({parentName:"pre"},{className:"language-js"}),"const fn = React.useCallback(() => {\n  setOut(true)\n}, [])\n")),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"useMemo",(0,s.kt)("ul",{parentName:"li"},(0,s.kt)("li",{parentName:"ul"},"ä¸€èˆ¬ç”¨äºç¼“å­˜ç»„ä»¶"),(0,s.kt)("li",{parentName:"ul"},"ç¼“å­˜å€¼: ",(0,s.kt)("inlineCode",{parentName:"li"},"const demo = React.useMemo(() => [...], [])"))))),(0,s.kt)("h3",null,"æ˜¯å¦èƒ½ä½¿ç”¨ React Hooks æ›¿ä»£ Redux"),(0,s.kt)("p",null,"åœ¨ React 16.8 ç‰ˆæœ¬ä¹‹å, é’ˆå¯¹",(0,s.kt)("inlineCode",{parentName:"p"},"ä¸æ˜¯ç‰¹åˆ«å¤æ‚"),"çš„ä¸šåŠ¡åœºæ™¯, å¯ä»¥ä½¿ç”¨ React æä¾›çš„ ",(0,s.kt)("inlineCode",{parentName:"p"},"useContext"),"ã€",(0,s.kt)("inlineCode",{parentName:"p"},"useReducer")," å®ç°è‡ªå®šä¹‰ç®€åŒ–ç‰ˆçš„ redux, å¯è§ ",(0,s.kt)("a",p({parentName:"p"},{href:"https://github.com/MuYunyun/todoList"}),"todoList")," ä¸­çš„è¿ç”¨ã€‚æ ¸å¿ƒä»£ç å¦‚ä¸‹:"),(0,s.kt)("pre",null,(0,s.kt)("code",p({parentName:"pre"},{className:"language-js"}),'import React, { createContext, useContext, useReducer } from "react"\n\n// åˆ›å»º StoreContext\nconst StoreContext = createContext()\n\n// æ„å»º Provider å®¹å™¨å±‚\nexport const StoreProvider = ({reducer, initialState, children}) => {\n  return (\n    <StoreContext.Provider value={useReducer(reducer, initialState)}>\n      {children}\n    </StoreContext.Provider>\n  )\n}\n\n// åœ¨å­ç»„ä»¶ä¸­è°ƒç”¨ useStoreContext, ä»è€Œå–å¾— Provider ä¸­çš„ value\nexport const useStoreContext = () => useContext(StoreContext)\n')),(0,s.kt)("p",null,"ä½†æ˜¯é’ˆå¯¹ç‰¹åˆ«å¤æ‚çš„åœºæ™¯ç›®å‰ä¸å»ºè®®ä½¿ç”¨æ­¤æ¨¡å¼, å› ä¸º context çš„æœºåˆ¶ä¼šæœ‰æ€§èƒ½é—®é¢˜ã€‚å…·ä½“åŸå› å¯è§ ",(0,s.kt)("a",p({parentName:"p"},{href:"https://github.com/reduxjs/react-redux/issues/1177"}),"react-redux v7 å›é€€åˆ°è®¢é˜…çš„åŸå› ")),(0,s.kt)("h4",null,"ä¾èµ–åˆ—è¡¨ä¸­ç§»é™¤å‡½æ•°æ˜¯å¦æ˜¯å®‰å…¨çš„?"),(0,s.kt)("p",null,"é€šå¸¸æ¥è¯´ä¾èµ–åˆ—è¡¨ä¸­ç§»é™¤å‡½æ•°æ˜¯ä¸å®‰å…¨çš„ã€‚è§‚å¯Ÿå¦‚ä¸‹ demo"),(0,s.kt)("pre",null,(0,s.kt)("code",p({parentName:"pre"},{className:"language-js"}),"const { useState, useEffect } = React\n\nfunction Example({ someProp }) {\n  function doSomething() {\n    console.log(someProp) // è¿™é‡Œåªè¾“å‡º 1, ç‚¹å‡»æŒ‰é’®çš„ 2 å¹¶æ²¡æœ‰è¾“å‡ºã€‚\n  }\n\n  useEffect(\n    () => {\n      doSomething()\n    },\n    [] // ğŸ”´ è¿™æ˜¯ä¸å®‰å…¨çš„, å› ä¸ºåœ¨ doSomething å‡½æ•°ä¸­ä½¿ç”¨äº† someProps å±æ€§\n  )\n\n  return <div>example</div>\n}\n\nexport default function() {\n  const [value, setValue] = useState(1)\n  return (\n    <>\n      <Example someProp={value} />\n      <Button onClick={() => setValue(2)}>button</Button>\n    </>\n  )\n}\n")),(0,s.kt)("p",null,"åœ¨è¯¥ demo ä¸­, ç‚¹å‡» button æŒ‰é’®, å¹¶æ²¡æœ‰æ‰“å°å‡º 2ã€‚è§£å†³ä¸Šè¿°é—®é¢˜æœ‰ä¸¤ç§æ–¹æ³•ã€‚"),(0,s.kt)("p",null,"æ–¹æ³•ä¸€: å°†å‡½æ•°æ”¾å…¥ ",(0,s.kt)("inlineCode",{parentName:"p"},"useEffect")," ä¸­, åŒæ—¶å°†ç›¸å…³å±æ€§æ”¾å…¥ä¾èµ–é¡¹ä¸­ã€‚å› ä¸ºåœ¨ä¾èµ–ä¸­æ”¹å˜çš„ç›¸å…³å±æ€§ä¸€ç›®äº†ç„¶, æ‰€ä»¥è¿™ä¹Ÿæ˜¯é¦–æ¨çš„åšæ³•ã€‚"),(0,s.kt)("pre",null,(0,s.kt)("code",p({parentName:"pre"},{className:"language-js"}),"function Example({ someProp }) {\n  useEffect(\n    () => {\n      function doSomething() {\n        console.log(someProp)\n      }\n      doSomething()\n    },\n    [someProps] // ç›¸å…³å±æ€§æ”¹å˜ä¸€ç›®äº†ç„¶\n  )\n\n  return <div>example</div>\n}\n")),(0,s.kt)("p",null,"æ–¹æ³•äºŒ: æŠŠå‡½æ•°åŠ å…¥ä¾èµ–åˆ—è¡¨ä¸­"),(0,s.kt)("pre",null,(0,s.kt)("code",p({parentName:"pre"},{className:"language-js"}),"function Example({ someProp }) {\n  function doSomething() {\n    console.log(someProp)\n  }\n\n  useEffect(\n    () => {\n      doSomething()\n    },\n    [doSomething]\n  )\n\n  return <div>example</div>\n}\n")),(0,s.kt)("p",null,"æ–¹æ¡ˆäºŒåŸºæœ¬ä¸Šä¸ä¼šå•ç‹¬ä½¿ç”¨, å®ƒä¸€èˆ¬ç»“åˆ ",(0,s.kt)("inlineCode",{parentName:"p"},"useCallback")," ä¸€èµ·ä½¿ç”¨æ¥å¤„ç†æŸäº›å‡½æ•°è®¡ç®—é‡è¾ƒå¤§çš„å‡½æ•°ã€‚"),(0,s.kt)("pre",null,(0,s.kt)("code",p({parentName:"pre"},{className:"language-js"}),"function Example({ someProp }) {\n  const doSomething = useCallback(() => {\n    console.log(someProp)\n  }, [someProp])\n\n  useEffect(\n    doSomething(),\n    [doSomething]\n  )\n\n  return <div>example</div>\n}\n")),(0,s.kt)("h4",null,"å¦‚ä½•é¿å…é‡å¤åˆ›å»ºæ˜‚è´µçš„å¯¹è±¡"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"æ–¹æ³•ä¸€: ä½¿ç”¨ ",(0,s.kt)("inlineCode",{parentName:"li"},"useState")," çš„æ‡’åˆå§‹åŒ–, ç”¨æ³•å¦‚ä¸‹")),(0,s.kt)("pre",null,(0,s.kt)("code",p({parentName:"pre"},{className:"language-js"}),"const [value, setValue] = useState(() => createExpensiveObj)\n")),(0,s.kt)("blockquote",null,(0,s.kt)("p",{parentName:"blockquote"},"è§ ",(0,s.kt)("a",p({parentName:"p"},{href:"https://reactjs.org/docs/hooks-reference.html#lazy-initial-state"}),"lazy-initial-state"),";")),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"æ–¹æ³•äºŒ: ä½¿ç”¨è‡ªå®šä¹‰ useRef å‡½æ•°")),(0,s.kt)("pre",null,(0,s.kt)("code",p({parentName:"pre"},{className:"language-js"}),"function Image(props) {\n  const ref = useRef(null)\n\n  function getExpensiveObj() {\n    if (ref.current === null) {\n      ref.current = ExpensiveObj\n    }\n\n    return ref.current\n  }\n\n  // if need ExpensiveObj, call getExpensiveObj()\n}\n")),(0,s.kt)("h3",null,"ç«æ€"),(0,s.kt)("p",null,"å…³äºç«æ€(race condition) çš„è§£å†³æ–¹æ³•:"),(0,s.kt)("p",null,"æ–¹æ¡ˆä¸€: æä¾›ä¸€ä¸ªæ ‡å¿—ç¬¦, åœ¨ ",(0,s.kt)("inlineCode",{parentName:"p"},"clean effect")," é˜¶æ®µä¸­å°†å…¶ç½®ç©ºã€‚ä»£ç å¦‚ä¸‹:"),(0,s.kt)("pre",null,(0,s.kt)("code",p({parentName:"pre"},{className:"language-js"}),"function Article({ id }) {\n  const [article, setArticle] = useState(null);\n\n  useEffect(() => {\n    let didCancel = false;\n\n    async function fetchData() {\n      const article = await API.fetchArticle(id);\n      if (!didCancel) {\n        setArticle(article);\n      }\n    }\n\n    fetchData();\n\n    return () => {\n      didCancel = true;\n    };\n  }, [id]);\n\n  // ...\n}\n")),(0,s.kt)("p",null,"æ–¹æ¡ˆäºŒ: ä½¿ç”¨ Suspense: Suspense çš„æœºåˆ¶èƒ½åšåˆ° ",(0,s.kt)("inlineCode",{parentName:"p"},"render as fetch"),"ã€‚è§ ",(0,s.kt)("a",p({parentName:"p"},{href:"https://reactjs.org/docs/concurrent-mode-suspense.html#solving-race-conditions-with-suspense"}),"solving-race-conditions-with-suspense")),(0,s.kt)("h3",null,"ç›¸å…³èµ„æ–™"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",p({parentName:"li"},{href:"https://github.com/reactjs/rfcs/pull/68#issuecomment-439314884"}),"Hooks RFCS")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",p({parentName:"li"},{href:"https://reactjs.org/docs/hooks-faq.html"}),"Hooks FAQ")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",p({parentName:"li"},{href:"https://medium.com/@dan_abramov/making-sense-of-react-hooks-fdbde8803889"}),"Making Sense of React Hooks")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",p({parentName:"li"},{href:"https://zhuanlan.zhihu.com/p/68477600"}),"Vue Function-based API RFC"))))}i.isMDXComponent=!0}}]);