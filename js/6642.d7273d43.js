(self.webpackChunkblog=self.webpackChunkblog||[]).push([[6642],{26642:(t,e,a)=>{"use strict";a.r(e),a.d(e,{default:()=>s});var l=a(59713),n=a.n(l),i=a(6479),r=a.n(i),p=(a(67294),a(3905));function o(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);e&&(l=l.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,l)}return a}function m(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?o(Object(a),!0).forEach((function(e){n()(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}var u={};function s(t){var e=t.components,a=r()(t,["components"]);return(0,p.kt)("wrapper",m(m(m({},u),a),{},{components:e,mdxType:"MDXLayout"}),(0,p.kt)("h3",null,"Lottie"),(0,p.kt)("ul",null,(0,p.kt)("li",{parentName:"ul"},"针对营销动画场景, 业界用的较多的是使用 Lottie 来开发。",(0,p.kt)("ul",{parentName:"li"},(0,p.kt)("li",{parentName:"ul"},"优点",(0,p.kt)("ul",{parentName:"li"},(0,p.kt)("li",{parentName:"ul"},"AE 香"),(0,p.kt)("li",{parentName:"ul"},"还原度高"))),(0,p.kt)("li",{parentName:"ul"},"缺点",(0,p.kt)("ul",{parentName:"li"},(0,p.kt)("li",{parentName:"ul"},"不支持动态数据"),(0,p.kt)("li",{parentName:"ul"},"沟通、适配成本"),(0,p.kt)("li",{parentName:"ul"},"低端机性能问题"),(0,p.kt)("li",{parentName:"ul"},"官方文档匮乏"))))),(0,p.kt)("li",{parentName:"ul"},"使用 css 来完成营销动效的效果(比如光影、滤镜效果)不会很好。"),(0,p.kt)("li",{parentName:"ul"},"支付宝营销动效方案:",(0,p.kt)("ul",{parentName:"li"},(0,p.kt)("li",{parentName:"ul"},"在线制作 -> 发布优化 -> 播放 JSON"),(0,p.kt)("li",{parentName:"ul"},"类 lottie 方案, 提供网页 ae, ",(0,p.kt)("a",m({parentName:"li"},{href:"https://render.alipay.com/p/s/mars-editor/"}),"https://render.alipay.com/p/s/mars-editor/"),", 转化为 WebGl"))),(0,p.kt)("li",{parentName:"ul"},(0,p.kt)("a",m({parentName:"li"},{href:"https://zhuanlan.zhihu.com/p/57576659"}),"网易云音乐年度报告从设计到代码"),"。")),(0,p.kt)("h3",null,"场景"),(0,p.kt)("ul",null,(0,p.kt)("li",{parentName:"ul"},"直播: 手势拜年特效"),(0,p.kt)("li",{parentName:"ul"},"素材属性编辑"),(0,p.kt)("li",{parentName:"ul"},"内容平台操作")),(0,p.kt)("h3",null,"实时动画"),(0,p.kt)("ul",null,(0,p.kt)("li",{parentName:"ul"},"还原度",(0,p.kt)("ul",{parentName:"li"},(0,p.kt)("li",{parentName:"ul"},"还原曲线描点等数据"),(0,p.kt)("li",{parentName:"ul"},"不同平台的渲染差异"))),(0,p.kt)("li",{parentName:"ul"},"性能",(0,p.kt)("ul",{parentName:"li"},(0,p.kt)("li",{parentName:"ul"},"Mars Player: ",(0,p.kt)("a",m({parentName:"li"},{href:"https://render.alipay.com/p/s/mars-editor/"}),"https://render.alipay.com/p/s/mars-editor/"),(0,p.kt)("ul",{parentName:"li"},(0,p.kt)("li",{parentName:"ul"},"图层、粒子、拖尾、模型、交互"),(0,p.kt)("li",{parentName:"ul"},"WebGl"))),(0,p.kt)("li",{parentName:"ul"},"Oasis 3d(蚂蚁): ",(0,p.kt)("a",m({parentName:"li"},{href:"https://oasis-engine.github.io/"}),"https://oasis-engine.github.io/")," 动画引擎、Hilo 3d(淘宝 开源)"),(0,p.kt)("li",{parentName:"ul"},"小程序、H5、Web3D 游戏"))),(0,p.kt)("li",{parentName:"ul"},"稳定性")),(0,p.kt)("h3",null,"Lottie 库使用"),(0,p.kt)("p",null,"lottie-web gzip 压缩后大小有 40kb 的大小。如果使用 npm 包的形式进行加载, 那么 vendor.js 会增加 40kb 的大小, 这样会使页面性能下降。"),(0,p.kt)("ul",null,(0,p.kt)("li",{parentName:"ul"},"方案一: 采用 script 标签的形式来加载 lottie 文件, 并且使用 defer 或 async 属性来进行异步加载。一般情况下, 我们只需要 svg 格式的动画, 所以可以使用 lottie_light 版本（仅支持 svg 渲染）。"),(0,p.kt)("li",{parentName:"ul"},"方案二: 因为 lottie 目前只在商家年度之夜中使用, 因此在特定路由中进行按需引入加载。")),(0,p.kt)("h4",null,"JSON 文件"),(0,p.kt)("p",null,"通过 bodymovin 插件导出的动画 JSON 文件大小也可能比较大(复杂的动画达到上百 kb), 所以不建议将 JSON 数据内联到页面中, 而最好是当做一个 JSON 文件来进行下载。"),(0,p.kt)("h4",null,"lottie-web 的基本用法"),(0,p.kt)("pre",null,(0,p.kt)("code",m({parentName:"pre"},{className:"language-js"}),"const animation = bodymovin.loadAnimation({\n  container: element,    // 要包含该动画的dom元素\n  renderer: 'svg',       // 渲染方式, svg、canvas、html（轻量版仅svg渲染）\n  loop: true,            // 是否循环播放\n  autoplay: true,        // 是否自动播放\n  animationData,         // 动画 JSON 文件(优先级比 path 高)\n  path: animateJsonPath, // 动画 JSON 文件路径\n});\n")),(0,p.kt)("h4",null,"lottie-web 常用方法"),(0,p.kt)("p",null,"lottie-web 提供了很多的控制动画播放的方法, 下面是一些常用的方法。animation 等于上面代码中的 animation。"),(0,p.kt)("pre",null,(0,p.kt)("code",m({parentName:"pre"},{className:"language-js"}),"animation.play(); // 播放该动画, 从目前停止的帧开始播放\nanimation.stop(); // 停止播放该动画, 回到第 0 帧\nanimation.pause(); // 暂停该动画, 在当前帧停止并保持\nanimation.goToAndStop(value, isFrame); // 跳到某个时刻/帧并停止。isFrame(默认false) 指示 value 表示帧还是时间(毫秒)\nanimation.goToAndPlay(value, isFrame); // 跳到某个时刻/帧并进行播放\nanimation.goToAndStop(30, true); // 跳转到第 30 帧并停止\nanimation.goToAndPlay(300); // 跳转到第 300 毫秒并播放\nanimation.playSegments(arr, forceFlag); // arr 可以包含两个数字或者两个数字组成的数组, forceFlag 表示是否立即强制播放该片段\nanimation.playSegments([10,20], false); // 播放完之前的片段, 播放 10-20 帧\nanimation.playSegments([[0,5],[10,18]], true); // 直接播放 0-5 帧和 10-18 帧\nanimation.setSpeed(speed); // 设置播放速度, speed为 1 表示正常速度\nanimation.setDirection(direction); // 设置播放方向, 1 表示正向播放, -1 表示反向播放\nanimation.destroy(); // 删除该动画, 移除相应的元素标签等。在unmount的时候, 需要调用该方法\n")),(0,p.kt)("h4",null,"lottie-web 常用的事件"),(0,p.kt)("p",null,"lottie-web 中可能也需要监听一些事件, 比如加载完动画 JSON 文件时的 data_ready 事件。监听方法如下:"),(0,p.kt)("pre",null,(0,p.kt)("code",m({parentName:"pre"},{className:"language-js"}),"animation.addEventListener('data_ready', () => {\n  console.log('animation data has loaded');\n});\n")),(0,p.kt)("p",null,"除了 ",(0,p.kt)("inlineCode",{parentName:"p"},"data_ready")," 事件, 下面还有一些其他常用的事件可以监听:"),(0,p.kt)("ul",null,(0,p.kt)("li",{parentName:"ul"},"complete: 播放完成（循环播放下不会触发）"),(0,p.kt)("li",{parentName:"ul"},"loopComplete: 当前循环下播放（循环播放/非循环播放）结束时触发"),(0,p.kt)("li",{parentName:"ul"},"enterFrame: 每进入一帧就会触发, 播放时每一帧都会触发一次, stop 方法也会触发"),(0,p.kt)("li",{parentName:"ul"},"segmentStart: 播放指定片段时触发"),(0,p.kt)("li",{parentName:"ul"},"playSegments、resetSegments 等方法刚开始播放指定片段时会发出, 如果 playSegments 播放多个片段, 多个片段最开始都会触发。"),(0,p.kt)("li",{parentName:"ul"},"data_ready: 动画 JSON 文件加载完毕触发"),(0,p.kt)("li",{parentName:"ul"},"DOMLoaded: 动画相关的 dom 已经被添加到 html 后触发"),(0,p.kt)("li",{parentName:"ul"},"destroy: 将在动画删除时触发")),(0,p.kt)("h4",null,"lottie-web 部分高阶用法"),(0,p.kt)("ol",null,(0,p.kt)("li",{parentName:"ol"},"在制作 AE 动画时, 将图层命名为 #svgId 格式, 前端加载该动画后, 相应的图层的 id 会被设置为 svgId, 可以通过 dom 方法获取该元素并做相应的操作;"),(0,p.kt)("li",{parentName:"ol"},"在制作 AE 动画时, 将图层命名为 .svgClass 格式, 前端加载该动画后, 相应的图层的 class 会被设置为 svgClass, 可以通过 dom 方法获取这些元素并做相应的操作;")),(0,p.kt)("h3",null,"相关链接"),(0,p.kt)("ul",null,(0,p.kt)("li",{parentName:"ul"},(0,p.kt)("a",m({parentName:"li"},{href:"https://lottiefiles.com/featured"}),"lottie 动效社区资源")),(0,p.kt)("li",{parentName:"ul"},(0,p.kt)("a",m({parentName:"li"},{href:"https://zhuanlan.zhihu.com/p/104751997"}),"现在你可以把 Lottie 动画导回 AE 了"),(0,p.kt)("ul",{parentName:"li"},(0,p.kt)("li",{parentName:"ul"},"经验证, 简单的动效可以, 复杂的不行。")))),(0,p.kt)("ul",m({},{className:"contains-task-list"}),(0,p.kt)("li",m({parentName:"ul"},{className:"task-list-item"}),(0,p.kt)("input",m({parentName:"li"},{type:"checkbox",checked:!1,disabled:!0}))," ",(0,p.kt)("a",m({parentName:"li"},{href:"https://juejin.cn/post/6914835547588395022"}),"剖析 lottie-web 动画实现原理")),(0,p.kt)("li",m({parentName:"ul"},{className:"task-list-item"}),(0,p.kt)("input",m({parentName:"li"},{type:"checkbox",checked:!1,disabled:!0}))," ",(0,p.kt)("a",m({parentName:"li"},{href:"https://jelly.jd.com/article/5fcf44b5a1c4e30142d0a472"}),"使用 Lottie 快速开发动画"))))}s.isMDXComponent=!0}}]);